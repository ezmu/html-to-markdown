<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HTML to Markdown Converter</title>
<style>
body { 
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
  margin: 20px; 
  background: #1e1e1e; 
  color: #f0f0f0; 
}
h1 { text-align: center; color: #66c0f4; }
.container { display: flex; flex-direction: column; gap: 15px; max-width: 1200px; margin: auto; }
input[type="text"], textarea { 
  width: 100%; 
  padding: 10px; 
  font-size: 14px; 
  border-radius: 5px; 
  border: 1px solid #444; 
  background: #2d2d2d; 
  color: #f0f0f0;
}
textarea { resize: vertical; }
button { 
  padding: 10px 20px; 
  font-size: 16px; 
  background-color: #66c0f4; 
  color: #1e1e1e; 
  border: none; 
  border-radius: 5px; 
  cursor: pointer; 
  transition: 0.3s; 
}
button:hover { background-color: #5390d9; }
label { font-weight: bold; margin-bottom: 5px; color: #a0a0a0; }
</style>
</head>
<body>

<h1>HTML to Markdown Converter - Select Element + CORS Proxy</h1>

<div class="container">
  <div>
    <label for="urlInput">Webpage URL:</label>
    <input type="text" id="urlInput" placeholder="https://example.com/page.html">
  </div>

  <div>
    <label for="selectorInput">CSS Selector of element to convert (e.g. #content or .article):</label>
    <input type="text" id="selectorInput" placeholder="#content">
  </div>

  <div>
    <button onclick="fetchAndConvert()">Fetch & Convert</button>
  </div>

  <div>
    <label for="htmlInput">Or paste HTML manually:</label>
    <textarea id="htmlInput" placeholder="Paste HTML here..."></textarea>
  </div>

  <div>
    <label>Markdown Output:</label>
    <textarea id="output" readonly></textarea>
  </div>

  <button onclick="downloadMarkdown()">Download Markdown</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/turndown/dist/turndown.js"></script>
<script>
const htmlInput = document.getElementById('htmlInput');
const output = document.getElementById('output');
let markdownContent = "";

const turndownService = new TurndownService({ headingStyle: 'atx', codeBlockStyle: 'fenced' });

turndownService.addRule('image', {
  filter: 'img',
  replacement: function(content, node) {
    const alt = node.getAttribute('alt') || '';
    const src = node.getAttribute('src') || '';
    return `![${alt}](${src})`;
  }
});

turndownService.addRule('link', {
  filter: 'a',
  replacement: function(content, node) {
    const href = node.getAttribute('href') || '';
    return `[${content}](${href})`;
  }
});

htmlInput.addEventListener('input', () => {
  markdownContent = turndownService.turndown(htmlInput.value);
  output.value = markdownContent;
});

function downloadMarkdown() {
  if (!markdownContent) { alert("Please convert some HTML first."); return; }
  const blob = new Blob([markdownContent], { type: 'text/markdown' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'output.md';
  a.click();
  URL.revokeObjectURL(url);
}

async function fetchAndConvert() {
  const url = document.getElementById('urlInput').value.trim();
  const selector = document.getElementById('selectorInput').value.trim();
  if (!url) { alert("Please enter a valid URL."); return; }
  if (!selector) { alert("Please enter a CSS selector."); return; }

  try {
    const proxyUrl = "https://api.allorigins.win/raw?url=";
    const response = await fetch(proxyUrl + encodeURIComponent(url));
    if (!response.ok) throw new Error("Failed to fetch URL via proxy.");
    const html = await response.text();

    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = html;

    const element = tempDiv.querySelector(selector);
    if (!element) { alert("Element not found with selector: " + selector); return; }

    htmlInput.value = element.innerHTML;
    markdownContent = turndownService.turndown(element.innerHTML);
    output.value = markdownContent;
  } catch (err) {
    alert("Error: " + err.message);
  }
}
</script>
</body>
</html>
